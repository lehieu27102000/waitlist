(()=>{if("undefined"==typeof jQuery){const i=document.createElement("script");i.src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js",i.onload=function(){t()},document.head.appendChild(i)}else t();async function t(){jQuery(document).ready((async function(t){try{const l={collection:".c7-product-collection",collectionProduct:".c7-product",c7Wrapper:"c7-content",waitlist:".c7-waitlist",form:"form",showModal:".show-waitlist-modal",joinWaitlist:".waitlist-submit",waitlistModal:".waitlist-modal-wrapper",waitlistEmail:".waitlist-email",waitlistModalClose:".close-wailtlist-modal",waitlistNotification:".waitlist-notification",waitlistForm:".waitlist-form"},n=t("#waitlist-javascript").data("tenant");var i={baseUrl:"https://api.commerce7.com/v1",tenantId:n,credentials:(t=>btoa(t))("waitlist:qsoINUkmk1vVLVhzN3M0zYlf2goxXixT06iRXt9X9jBBF624cbuvv38RvjpwXmVo")};async function e(t,e=null,a="GET"){try{const o="GET"===a&&e?"?"+new URLSearchParams(e).toString():"",s=await fetch(`${i.baseUrl}${t}${o}`,{method:a,headers:{Authorization:`Basic ${i.credentials}`,tenant:i.tenantId,"Content-Type":"application/json"},body:"POST"===a?JSON.stringify(e):null});if(!s.ok)throw new Error("Commerce7 Response Error");return await s.json()}catch(t){throw console.error("API Error:",t),t}}if(!await e("/customer"))return;var a={},o=null;const r=async()=>{try{const t=c("customerToken"),e=await async function(t){if(!t||!i.tenantId)return{success:!1,data:null};try{const e=await fetch(`${i.baseUrl}/customer/self`,{method:"GET",headers:{Authorization:t,tenant:i.tenantId,"Content-Type":"application/json"}});if(!e.ok)throw new Error("API request failed");return{success:!0,data:await e.json()}}catch(t){return console.error("Error fetching customer data:",t),{success:!1,data:null}}}(t);a=e.data;const o=document.querySelectorAll(l.collection);o&&o.forEach((t=>{new MutationObserver(((i,e)=>{const a=t.querySelectorAll(l.collectionProduct);a&&(a.forEach((t=>{const i=t.querySelector(l.waitlist),e=t.querySelector(l.form),a=t.querySelector(".c7-message"),o=t.querySelector(".c7-product__login-message");e||s(t.querySelector("a").getAttribute("href"),a,o,(function(t){i.innerHTML=t}))})),e.disconnect())})).observe(t,{childList:!0,subtree:!0})}));const n=document.getElementById(l.c7Wrapper);n&&window.location.href.includes("/product/")&&new MutationObserver(((t,i)=>{const e=document.querySelector(l.waitlist);if(e){const t=n.querySelector(l.form),a=n.querySelector(".c7-message"),o=n.querySelector(".c7-product__login-message");t||s(window.location.href,a,o,(function(t){e.innerHTML=t})),i.disconnect()}})).observe(n,{childList:!0,subtree:!0})}catch(t){console.log(t)}};function s(t,i,e,o){const s=t.split("/"),l=s.pop()||s.pop();let n=!1,r="";if(!a)return i||e||(r+='<h5 class="product-soldout">Sold Out</h5>',r+=`<button class="button primary show-waitlist-modal" data-title="${l}">Join Waitlist</button>`),void o(r);i||e||(n=!0,r+='<h5 class="product-soldout">Sold Out</h5>'),r+=`<button class="button primary show-waitlist-modal ${n?"":"for-club"}" data-title="${l}">Join Waitlist</button>`,o(r)}const c=t=>{for(var i=t+"=",e=decodeURIComponent(document.cookie).split(";"),a=0;a<e.length;a++){for(var o=e[a];" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(i))return o.substring(i.length,o.length)}return""};jQuery(document).on("click",l.showModal,(function(i){jQuery(".c7-product-popup-close").click();const e=jQuery(this).data("title");t(this).hasClass("for-club")?d(t(this)):jQuery("body").append(u("",e,t(this)))}));const d=t=>{a&&m(t)},u=(t,i,e)=>{if(!a)return o=e,'<div class="waitlist-modal-wrapper" id="waitlist-modal"><div class="waitlist-modal-content"><span class="close-wailtlist-modal">+</span><h2>Waitlist Signup</h2><p>Please add your email address below and we will notify you when this is available for purchase.</p><div class="waitlist-form"><label>Email Address *</label><input type="email" class="waitlist-email"><p class="waitlist-notification"></p><div class="button primary waitlist-submit" data-title="'+i+'">Submit</div></div></div></div>';m(e)},m=async i=>{try{const o=a&&a.emails&&a.emails[0]&&a.emails[0].email?a.emails[0].email:jQuery(l.waitlistEmail).val(),s=i.data("title");if(jQuery(l.waitlistNotification).html(""),!function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)&&!/^(test|fake|spam|noreply)[\w.-]*@/i.test(t)}(o)||!o)return void jQuery(l.waitlistNotification).html("Please enter your email and make sure it is in the correct format.");jQuery("body").append('<div class="waitlist-modal-wrapper loading-modal" id="loading-modal"><div class="waitlist-modal-content"><div class="loading-spinner"></div></div></div>');const n=await e("/customer/",{q:o});let r;r=0===n.total?(await e("/customer/",{emails:[{email:o}]},"POST")).id:n.customers[0].id;const c=`Waitlist: ${s}`,d=await e("/tag/customer/",{q:c});let u;u=0===d.total?(await e("/tag/customer/",{title:c,type:"Manual"},"POST")).id:d.tags[0].id,await e("/tag-x-object/customer/",{objectId:r,tagId:u},"POST"),jQuery("#loading-modal").remove(),w(),t(i).closest(l.waitlist).find("button").text("Waitlisted")}catch(t){jQuery("#loading-modal").remove(),alert("System is busy at this moment. Please try again later.")}},w=()=>{if(jQuery(l.waitlistForm).length>0)return jQuery(l.waitlistForm).html("Received! You're on the list!"),t(o).text("Waitlisted"),void t(o).removeClass("show-waitlist-modal");jQuery("body").append('<div class="waitlist-modal-wrapper" id="waitlist-modal"><div class="waitlist-modal-content"><span class="close-wailtlist-modal">+</span><h2>Waitlist Signup</h2><div class="waitlist-form"><p class="waitlist-notification">Received! You\'re on the list!</p></div></div></div>')};jQuery(document).on("click",l.joinWaitlist,(function(){m(t(this))})),jQuery(document).on("click",l.waitlistModalClose,(function(){jQuery(l.waitlistModal).remove()})),r()}catch(p){console.log(p)}}))}})();
//# sourceMappingURL=waitlist.min.js.map