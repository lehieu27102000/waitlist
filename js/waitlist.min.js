(()=>{if("undefined"==typeof jQuery){const e=document.createElement("script");e.src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js",e.onload=function(){t()},document.head.appendChild(e)}else t();async function t(){jQuery(document).ready((async function(t){try{const u={collection:".c7-product-collection",collectionProduct:".c7-product",c7Wrapper:"c7-content",waitlist:".c7-waitlist",form:"form",showModal:".show-waitlist-modal",joinWaitlist:".waitlist-submit",waitlistModal:".waitlist-modal-wrapper",waitlistEmail:".waitlist-email",waitlistModalClose:".close-wailtlist-modal",waitlistNotification:".waitlist-notification",waitlistForm:".waitlist-form"},m=t("#waitlist-javascript").data("tenant");var e={baseUrl:"https://api.commerce7.com/v1",tenantId:m,credentials:(t=>btoa(t))("waitlist:qsoINUkmk1vVLVhzN3M0zYlf2goxXixT06iRXt9X9jBBF624cbuvv38RvjpwXmVo")};async function o(t,o=null,i="GET"){try{const a="GET"===i&&o?"?"+new URLSearchParams(o).toString():"",s=await fetch(`${e.baseUrl}${t}${a}`,{method:i,headers:{Authorization:`Basic ${e.credentials}`,tenant:e.tenantId,"Content-Type":"application/json"},body:"POST"===i?JSON.stringify(o):null});if(!s.ok)throw new Error("Commerce7 Response Error");return await s.json()}catch(t){throw console.error("API Error:",t),t}}var i={baseUrl:"https://doant72.sg-host.com/",tenantId:m};if(!await o("/customer"))return;var a=await async function(t,e=null,o="GET"){try{const a="GET"===o&&e?"?"+new URLSearchParams(e).toString():"",s=await fetch(`${i.baseUrl}${t}${a}`,{method:o,headers:{"Content-Type":"application/json"},body:"POST"===o?JSON.stringify(e):null});if(!s.ok)throw new Error("App Waitlist Response Error");return await s.json()}catch(t){throw console.error("API Error:",t),t}}("/api/waitlist-settings",{tenant_id:m});if(console.log(a),!a.enabled)return;const p=a.button_text;var s=JSON.parse(p).btn_text,n=JSON.parse(p).btn_text_submitted,l=JSON.parse(a.button_style);const w=`\n    .btn-primary {\n        background-color: ${l.backgroundColor};\n        color: ${l.textColor};\n        outline: ${l.outlineWidth} ${l.outlineStyle} ${l.outlineColor};\n    }\n    .btn-primary:hover {\n        background-color: ${l.hoverBackgroundColor};\n        color: ${l.hoverTextColor};\n    }\n`,h=document.createElement("style");h.innerHTML=w,document.head.appendChild(h);var r={},c=null;const y=async()=>{try{const t=f("customerToken"),o=await async function(t){if(!t||!e.tenantId)return{success:!1,data:null};try{const o=await fetch(`${e.baseUrl}/customer/self`,{method:"GET",headers:{Authorization:t,tenant:e.tenantId,"Content-Type":"application/json"}});if(!o.ok)throw new Error("API request failed");return{success:!0,data:await o.json()}}catch(t){return console.error("Error fetching customer data:",t),{success:!1,data:null}}}(t);r=o.data;const i=document.querySelectorAll(u.collection);i&&i.forEach((t=>{new MutationObserver(((e,o)=>{const i=t.querySelectorAll(u.collectionProduct);i&&(i.forEach((t=>{const e=t.querySelector(u.waitlist),o=t.querySelector(u.form),i=t.querySelector(".c7-message"),a=t.querySelector(".c7-product__login-message");o||d(t.querySelector("a").getAttribute("href"),i,a,(function(t){e.innerHTML=t}))})),o.disconnect())})).observe(t,{childList:!0,subtree:!0})}));const a=document.getElementById(u.c7Wrapper);a&&window.location.href.includes("/product/")&&new MutationObserver(((t,e)=>{const o=document.querySelector(u.waitlist);if(o){const t=a.querySelector(u.form),i=a.querySelector(".c7-message"),s=a.querySelector(".c7-product__login-message");t||d(window.location.href,i,s,(function(t){o.innerHTML=t})),e.disconnect()}})).observe(a,{childList:!0,subtree:!0})}catch(t){console.log(t)}};function d(t,e,o,i){const a=t.split("/"),n=a.pop()||a.pop();let l=!1,c="";if(!r)return e||o||(c+='<h5 class="product-soldout">Sold Out</h5>',c+=`<button class="btn-primary show-waitlist-modal" data-title="${n}">${s}</button>`),void i(c);e||o||(l=!0,c+='<h5 class="product-soldout">Sold Out</h5>'),c+=`<button class="btn-primary show-waitlist-modal ${l?"":"for-club"}" data-title="${n}">${s}</button>`,i(c)}const f=t=>{for(var e=t+"=",o=decodeURIComponent(document.cookie).split(";"),i=0;i<o.length;i++){for(var a=o[i];" "===a.charAt(0);)a=a.substring(1);if(0===a.indexOf(e))return a.substring(e.length,a.length)}return""};jQuery(document).on("click",u.showModal,(function(e){jQuery(".c7-product-popup-close").click();const o=jQuery(this).data("title");t(this).hasClass("for-club")?b(t(this)):jQuery("body").append(v("",o,t(this)))}));const b=t=>{r&&g(t)},v=(t,e,o)=>{if(!r)return t=`<div class="waitlist-modal-wrapper" id="waitlist-modal"><div class="waitlist-modal-content"><span class="close-wailtlist-modal">+</span><h2>${a.popup_title}</h2><p>${a.popup_body}</p><div class="waitlist-form"><label>Email Address *</label><input type="email" class="waitlist-email"><p class="waitlist-notification"></p><button class="btn-primary waitlist-submit" data-title="${e}">Submit</button></div></div></div>`,c=o,t;g(o)},g=async e=>{try{const i=r&&r.emails&&r.emails[0]&&r.emails[0].email?r.emails[0].email:jQuery(u.waitlistEmail).val(),a=e.data("title");if(jQuery(u.waitlistNotification).html(""),!function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)&&!/^(test|fake|spam|noreply)[\w.-]*@/i.test(t)}(i)||!i)return void jQuery(u.waitlistNotification).html("Please enter your email and make sure it is in the correct format.");jQuery("body").append('<div class="waitlist-modal-wrapper loading-modal" id="loading-modal"><div class="waitlist-modal-content"><div class="loading-spinner"></div></div></div>');const s=await o("/customer/",{q:i});let l;l=0===s.total?(await o("/customer/",{emails:[{email:i}]},"POST")).id:s.customers[0].id;const c=`Waitlist: ${a}`,d=await o("/tag/customer/",{q:c});let m;m=0===d.total?(await o("/tag/customer/",{title:c,type:"Manual"},"POST")).id:d.tags[0].id,await o("/tag-x-object/customer/",{objectId:l,tagId:m},"POST"),jQuery("#loading-modal").remove(),j(),t(e).closest(u.waitlist).find("button").text(n)}catch(t){jQuery("#loading-modal").remove(),alert("System is busy at this moment. Please try again later.")}},j=()=>{if(jQuery(u.waitlistForm).length>0)return jQuery(u.waitlistForm).html(a.success_message),t(c).text(n),void t(c).removeClass("show-waitlist-modal");const e=`<div class="waitlist-modal-wrapper" id="waitlist-modal"><div class="waitlist-modal-content"><span class="close-wailtlist-modal">+</span><h2>${a.popup_title}</h2><div class="waitlist-form"><p class="waitlist-notification">${a.success_message}</p></div></div></div>`;jQuery("body").append(e)};jQuery(document).on("click",u.joinWaitlist,(function(){g(t(this))})),jQuery(document).on("click",u.waitlistModalClose,(function(){jQuery(u.waitlistModal).remove()})),y()}catch(S){console.log(S)}}))}})();
//# sourceMappingURL=waitlist.min.js.map