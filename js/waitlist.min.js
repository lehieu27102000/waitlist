(()=>{if("undefined"==typeof jQuery){const e=document.createElement("script");e.src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js",e.onload=function(){t()},document.head.appendChild(e)}else t();function t(){jQuery(document).ready((function(t){const e=".c7-waitlist",i="form",a=".waitlist-notification",o=".waitlist-form";var s={},l=null;var n={baseUrl:"https://api.commerce7.com/v1",tenantId:t("#waitlist-javascript").data("tenant"),credentials:btoa("waitlist:qsoINUkmk1vVLVhzN3M0zYlf2goxXixT06iRXt9X9jBBF624cbuvv38RvjpwXmVo")};async function r(t,e=null,i="GET"){try{const a="GET"===i&&e?"?"+new URLSearchParams(e).toString():"",o=await fetch(`${n.baseUrl}${t}${a}`,{method:i,headers:{Authorization:`Basic ${n.credentials}`,tenant:n.tenantId,"Content-Type":"application/json"},body:"POST"===i?JSON.stringify(e):null});if(!o.ok)throw new Error("Commerce7 Response Error");return await o.json()}catch(t){throw console.error("API Error:",t),t}}function c(t,e,i,a){const o=t.split("/"),l=o.pop()||o.pop();let n=!1,r="";if(!s)return e||i||(r+='<h5 class="product-soldout">Sold Out</h5>',r+=`<button class="button primary show-waitlist-modal" data-title="${l}">Join Waitlist</button>`),void a(r);e||i||(n=!0,r+='<h5 class="product-soldout">Sold Out</h5>'),r+=`<button class="button primary show-waitlist-modal ${n?"":"for-club"}" data-title="${l}">Join Waitlist</button>`,a(r)}jQuery(document).on("click",".show-waitlist-modal",(function(e){jQuery(".c7-product-popup-close").click();const i=jQuery(this).data("title");t(this).hasClass("for-club")?d(t(this)):jQuery("body").append(u("",i,t(this)))}));const d=t=>{s&&m(t)},u=(t,e,i)=>{if(!s)return l=i,'<div class="waitlist-modal-wrapper" id="waitlist-modal"><div class="waitlist-modal-content"><span class="close-wailtlist-modal">+</span><h2>Waitlist Signup</h2><p>Please add your email address below and we will notify you when this is available for purchase.</p><div class="waitlist-form"><label>Email Address *</label><input type="email" class="waitlist-email"><p class="waitlist-notification"></p><div class="button primary waitlist-submit" data-title="'+e+'">Submit</div></div></div></div>';m(i)},m=async i=>{try{const o=s&&s.emails&&s.emails[0]&&s.emails[0].email?s.emails[0].email:jQuery(".waitlist-email").val(),l=i.data("title");if(jQuery(a).html(""),!function(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}(o)||!o)return void jQuery(a).html("Input valid email address.");jQuery("body").append('<div class="waitlist-modal-wrapper loading-modal" id="loading-modal"><div class="waitlist-modal-content"><div class="loading-spinner"></div></div></div>');const n=await r("/customer/",{q:o});let c;c=0===n.total?(await r("/customer/",{emails:[{email:o}]},"POST")).id:n.customers[0].id;const d=`Waitlist: ${l}`,u=await r("/tag/customer/",{q:d});let m;m=0===u.total?(await r("/tag/customer/",{title:d,type:"Manual"},"POST")).id:u.tags[0].id,await r("/tag-x-object/customer/",{objectId:c,tagId:m},"POST"),jQuery("#loading-modal").remove(),p(),t(i).closest(e).find("button").text("Waitlisted")}catch(t){jQuery("#loading-modal").remove(),alert("System is busy at this moment. Please try again later.")}},p=()=>{if(jQuery(o).length>0)return jQuery(o).html("Received! You're on the list!"),t(l).text("Waitlisted"),void t(l).removeClass("show-waitlist-modal");jQuery("body").append('<div class="waitlist-modal-wrapper" id="waitlist-modal"><div class="waitlist-modal-content"><span class="close-wailtlist-modal">+</span><h2>Waitlist Signup</h2><div class="waitlist-form"><p class="waitlist-notification">Received! You\'re on the list!</p></div></div></div>')};jQuery(document).on("click",".waitlist-submit",(function(){m(t(this))})),jQuery(document).on("click",".close-wailtlist-modal",(function(){jQuery(".waitlist-modal-wrapper").remove()})),(async()=>{try{const t=(t=>{for(var e=t+"=",i=decodeURIComponent(document.cookie).split(";"),a=0;a<i.length;a++){for(var o=i[a];" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(e))return o.substring(e.length,o.length)}return""})("customerToken"),a=await async function(t){if(!t||!n.tenantId)return{success:!1,data:null};try{const e=await fetch(`${n.baseUrl}/customer/self`,{method:"GET",headers:{Authorization:t,tenant:n.tenantId,"Content-Type":"application/json"}});if(!e.ok)throw new Error("API request failed");return{success:!0,data:await e.json()}}catch(t){return console.error("Error fetching customer data:",t),{success:!1,data:null}}}(t);s=a.data;const o=document.querySelectorAll(".c7-product-collection");o&&o.forEach((t=>{new MutationObserver(((a,o)=>{const s=t.querySelectorAll(".c7-product");s&&(s.forEach((t=>{const a=t.querySelector(e),o=t.querySelector(i),s=t.querySelector(".c7-message"),l=t.querySelector(".c7-product__login-message");o||c(t.querySelector("a").getAttribute("href"),s,l,(function(t){a.innerHTML=t}))})),o.disconnect())})).observe(t,{childList:!0,subtree:!0})}));const l=document.getElementById("c7-content");l&&window.location.href.includes("/product/")&&new MutationObserver(((t,a)=>{const o=document.querySelector(e);if(o){const t=l.querySelector(i),e=l.querySelector(".c7-message"),s=l.querySelector(".c7-product__login-message");t||c(window.location.href,e,s,(function(t){o.innerHTML=t})),a.disconnect()}})).observe(l,{childList:!0,subtree:!0})}catch(t){console.log(t)}})()}))}})();
//# sourceMappingURL=waitlist.min.js.map